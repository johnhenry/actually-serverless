<!DOCTYPE html>
<html lang="en">
  <template id="template-host">
    <div id="$HOST_ID" class="host">
      <main>
        <span
          class="set-strategy circ first"
          title="select strategy: first"
          data-strategy="first"
        >
        </span>
        <span
          class="set-strategy circ last-used"
          title="select strategy: last-used"
          data-strategy="last-used"
        >
        </span>
        <span
          class="set-strategy circ round-robin"
          title="select strategy: round-robin"
          data-strategy="round-robin"
        >
        </span>
        <span
          class="set-strategy circ random"
          title="select strategy: random"
          data-strategy="random"
        >
        </span>
        <a
          href="./host/$HOST_ID/"
          target="_blank"
          rel="opener"
          title="host/$HOST_ID"
          >$HOST_ID/</a
        >

        <button onclick="" class="load-function-file">ùëì</button>

        <button class="set-file-handler">üìÅ</button>
        <button class="claim-host">+</button>
        <span class="release-host close"></span>
      </main>
      <textarea
        class="update-function"
        placeholder="Click üìÅ to serve a folder or add some code here to modify a request.
Double-lick to load file."
      >
$FUNCTION_TEXT</textarea
      >
    </div>
  </template>
  <head>
    <meta name="charset" value="utf8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Local Cluster for web development</title>
    <!--TODO: Update icon-->
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto+Mono"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Oswald"
    />
    <link rel="manifest" href="https://johnhenry.github.io/manifest.json" />
    <link
      rel="stylesheet"
      href="https://johnhenry.github.io/lib/vendor/css/reset/2.0.0/index.css"
    />
    <link
      rel="stylesheet"
      href="https://johnhenry.github.io/lib/css/universal-unstyled-links/0.0.0/index.css"
    />
    <link
      rel="stylesheet"
      href="https://johnhenry.github.io/lib/css/universal-box-sizing/0.0.0/index.css"
    />
    <link
      rel="stylesheet"
      href="https://johnhenry.github.io/lib/css/universal-no-margins/0.0.0/index.css"
    />

    <link rel="stylesheet" href="index.css" />
    <script type="module">
      import IDBKeyVal from "./idb-keyval.mjs";
      window.IDBKeyVal = IDBKeyVal;
    </script>
    <script src="index.mjs" type="module"></script>
  </head>
  <body>
    <header>
      <a class="title" title="hosts" href="#"><h1>Local Custer</h1></a>
      <a title="hosts" href="#">Hosts</a>
      <a title="environment" href="#environment">Environment</a>
      <a title="requests" href="#requests">Requests</a>

      <a title="logs" href="#logs">Logs</a>
      <a title="settings" href="#settings">Settings</a>
      <a title="about" href="#about">About</a>
      <span
        >Node-<span id="client-index"></span
        ><a href="." target="_blank"> +</a></span
      >
    </header>
    <section class="pages">
      <section id="environment" class="view">
        <p class="help-text">Set environment variables for this cluster.</p>
        <textarea
          id="environment-variables"
          placeholder="VAR_0=val0
VAR_1=val1
..."
        ></textarea>
      </section>
      <section id="requests" class="view">
        <p class="help-text">Send requests to hosts in this cluster.</p>
        <div id="requests-form">
          <span>
            <input id="requests-method" placeholder="method" value="GET" />
            <label>host/</label>
            <select id="requests-hosts"></select
            ><label>/</label>
            <input id="requests-path" placeholder="path" value="" />
            <label>HTTP/1.1</label>
          </span>
          <textarea
            id="requests-headers"
            placeholder="content-type: text/plain
accept: ...
..."
          ></textarea>
          <textarea id="requests-body"></textarea>
          <button id="requests-send">Send</button>
        </div>
        <div id="response-box">
          <div id="responses"></div>
        </div>
      </section>

      <section id="settings" class="view">
        <p class="help-text">Site settings</p>
        <span>
          Inject Variables :
          <label>
            context
            <input type="checkbox" id="settings-variables-inject-context" />
          </label>
          <label>
            global
            <input type="checkbox" id="settings-variables-inject-global" />
          </label>
        </span>
        <span>
          Theme:
          <label>
            auto
            <input type="radio" name="settings-theme" value="auto" />
          </label>
          <label>
            dark
            <input type="radio" name="settings-theme" value="dark" />
          </label>
          <label>
            light
            <input type="radio" name="settings-theme" value="light" />
          </label>
        </span>
      </section>
      <section id="about" class="view">
        <p class="help-text">About this service.</p>
        <div>
          <h3>What is this</h3>
          <p>
            This site allows you to run a cluster of servers locally, within
            your browser.
          </p>
          <p>
            It works by using a service worker as a load balancer to intercept
            requests and routes them to open tabs.
          </p>
          <p>
            A request matching a given host (at /host/:hostname/...rest of url)
            is sent to a tab where it is handled via <a>worker function</a> or a
            static folder.
          </p>
          <p>
            Workers functions have access to browser APIs including fetch and
            alerts -- just to name a few -- as well as browser extensions. These
            can all be used to handle requests.
          </p>
          <h3>Why is it useful</h3>
          <p>A few use cases:</p>
          <h4>Secure origin</h4>
          <p>
            Today, it is nearly impossible to do web development without a
            server. Many browser APIs fail when a site is opened via the local
            file system.
          </p>
          <p>
            This services allows you to server any number of local folders
            without installing a server. Additoinally, since this service is
            served on a secure origin, you avoid that whole problem as well.
          </p>
          <h4>Testing Cloud Functions</h4>
          <p>
            This service allows one to easily fire up and test cloud functions.
            It aims to be largely compatible with offerings like Deno Deploy and
            Cloudflare Workers.
          </p>
          <h3>Comparison to Serevefolder.dev</h3>
          <p>
            This is a fork of
            <a
              href="https://github.com/AshleyScirra/servefolder.dev"
              target="_blank"
              >servefolder.dev</a
            >

            <a href="https://servefolder.dev/" target="_blank">(hosted here)</a
            >, so comparisons are welcome.
          </p>
          <table class="comparison-table">
            <tr>
              <th>Feature</th>
              <th>Servefolder.dev</th>
              <th>LocalCluster</th>
            </tr>
            <tr>
              <td>Static Directories</td>
              <td colspan="2" class="clear-winner">‚úì</td>
            </tr>
            <tr>
              <td>Cloud Functions</td>
              <td>êÑÇ</td>
              <td class="clear-winner">‚úì</td>
            </tr>

            <tr>
              <td>Browser Compatibility</td>
              <td class="clear-winner">All Major Browsers</td>
              <td>Chrome + Edge</td>
            </tr>
            <tr>
              <td>Host/Tab Topology</td>
              <td>One-to-One</td>
              <td class="clear-winner">Many-To-Many</td>
            </tr>
            <tr>
              <td>Backup</td>
              <td>Some settings saved.</td>
              <td class="clear-winner">Most settings saved. Export/import.</td>
            </tr>
          </table>
        </div>
      </section>
      <section id="logs" class="view">
        <p class="help-text">View requests/response logs on this node.</p>
        <div id="log-box"></div>
      </section>
      <section id="hosts" class="view hosts">
        <p class="help-text">Manage hosts on this node.</p>
        <span id="hosts-controls">
          <button id="add-host">Add Host</button>
          <label>
            <input type="checkbox" id="settings-random-hostname" />
            Random Name
          </label>
          <button id="settings-reload-cluster">reload</button>
          <button id="settings-reset-cluster">reset</button>
          <button id="settings-reset-cluster-and-close">reset + close</button>
          |
          <a
            class="button"
            download="cluster-backup.json"
            id="settings-download-save"
            >save</a
          >
          <button id="settings-upload-save">restore</button>
        </span>
        <input type="file" id="select-file" style="display: none" />
        <div id="host-list"></div>
      </section>
    </section>
  </body>
</html>
